<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI - Camera 1 - The Bridges</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#10b981", secondary: "#6b7280" },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
    <style>
      :where([class^="ri-"])::before {
        content: "\f3c2";
      }
      body {
        font-family: "Outfit", sans-serif;
      }
      .camera-feed {
        background-image: url("https://readdy.ai/api/search-image?query=construction%2520site%2520with%2520concrete%2520structures%2520and%2520scaffolding%252C%2520aerial%2520view%2520of%2520construction%2520in%2520progress%252C%2520workers%2520in%2520safety%2520gear%252C%2520machinery%2520and%2520equipment%252C%2520desert%2520environment%252C%2520bright%2520daylight%252C%2520realistic%2520photo&width=1200&height=800&seq=123456&orientation=landscape");
        background-size: cover;
        background-position: center;
      }
      .breadcrumb-item:not(:last-child)::after {
        content: "/";
        margin: 0 0.5rem;
        color: #9ca3af;
      }

      #sparkline-container {
        transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out;
        max-height: 0; /* Collapsed by default */
        opacity: 0; /* Hidden by default */
        /* overflow: hidden;  */
      }

      #sparkline-container.expanded {
        max-height: 400px; /* Adjust as needed for your content */
        opacity: 1;
      }

      .bar-container .w-6 {
        /* Assuming w-6 is your bar class */
        transition: height 0.4s ease-out; /* Animate height */
        height: 0; /* Initial height for animation */
      }

      /* Tooltip base style */
      .tooltip-container {
        position: relative; /* Needed for absolute positioning of tooltip */
      }

      .tooltip-content {
        opacity: 0;
        position: absolute;
        bottom: 100%; /* Position above the bar */
        left: 50%;
        transform: translateX(-50%) translateY(10px); /* Start slightly below and centered */
        margin-bottom: 8px; /* Space between bar and tooltip */
        padding: 6px 10px;
        background-color: #2d3748; /* bg-slate-800 */
        color: white;
        font-size: 0.75rem; /* text-xs */
        border-radius: 4px; /* rounded */
        white-space: nowrap;
        z-index: 50;
        transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        pointer-events: none; /* Tooltip itself should not capture hover */
      }

      /* Show tooltip on hover of its specific bar-container */
      .bar-container:hover .tooltip-content {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      @media (max-width: 768px) {
        .sparkline {
          flex-direction: column;
        }
      }

      /* Custom Scrollbar for Timeline Thumbnails */
      .custom-scrollbar {
        scrollbar-width: thin; /* For Firefox */
        scrollbar-color: #9ca3af #e5e7eb; /* thumb and track color for Firefox */
      }
      .custom-scrollbar::-webkit-scrollbar {
        height: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #e5e7eb; /* bg-slate-200 */
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #9ca3af; /* bg-slate-400 */
        border-radius: 10px;
        border: 2px solid #e5e7eb; /* bg-slate-200 to create padding */
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background-color: #6b7280; /* bg-slate-500 */
      }

      .pulsating-dot {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: red;
        border-radius: 50%;
        transform: translate(-50%, -50%); /* Center on the timeline track */
        animation: pulse 1.5s infinite ease-in-out;
        box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
        z-index: 5; /* Above timeline track, below slider thumb if overlapping */
      }

      @keyframes pulse {
        0% {
          transform: translate(-50%, -50%) scale(0.9);
          box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
        }
        70% {
          transform: translate(-50%, -50%) scale(1.2);
          box-shadow: 0 0 0 10px rgba(255, 0, 0, 0);
        }
        100% {
          transform: translate(-50%, -50%) scale(0.9);
          box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
        }
      }
    </style>
  </head>
  <body class="bg-slate-100 min-h-screen">
    <div class="flex flex-col h-screen">
      <!-- Header -->
      <header class="bg-white border-b border-slate-200 px-4 py-3">
        <div class="flex justify-between items-center">
          <!-- Breadcrumb and Title -->
          <div>
            <div class="flex items-center text-sm text-slate-500 mb-1">
              <span class="breadcrumb-item">Dashboard</span>
              <span class="breadcrumb-item">The Bridges</span>
              <span class="breadcrumb-item text-slate-700">AI - Camera 1</span>
            </div>
            <h1 class="text-xl font-semibold text-slate-900">
              AI - Camera 1 - The Bridges
            </h1>
          </div>
          <!-- Action Buttons -->
          <div class="flex items-center space-x-3">
            <button
              class="flex items-center px-3 py-2 border border-slate-300 rounded-button text-sm font-medium text-slate-700 bg-white hover:bg-slate-50 whitespace-nowrap"
            >
              <div class="w-5 h-5 flex items-center justify-center mr-2">
                <i class="ri-camera-line"></i>
              </div>
              Change Camera
            </button>
            <div class="relative">
              <button
                class="flex items-center px-3 py-2 border border-slate-300 rounded-button text-sm font-medium text-slate-700 bg-white hover:bg-slate-50 whitespace-nowrap"
              >
                <div class="w-5 h-5 flex items-center justify-center mr-2">
                  <i class="ri-download-line"></i>
                </div>
                Download image
                <div class="w-5 h-5 flex items-center justify-center ml-1">
                  <i class="ri-arrow-down-s-line"></i>
                </div>
              </button>
            </div>
            <button
              class="w-9 h-9 flex items-center justify-center rounded-full border border-slate-300 bg-white hover:bg-slate-50"
            >
              <i class="ri-refresh-line"></i>
            </button>
          </div>
        </div>
      </header>
      <!-- Main Content -->
      <div class="flex-1 flex overflow-hidden">
        <!-- Main Camera Feed Area -->
        <div class="flex-1 relative">
          <!-- Tools Bar -->
          <div class="absolute top-4 left-4 z-10 flex items-center space-x-3">
            <button
              class="flex items-center px-3 py-2 bg-white border border-slate-300 rounded-button shadow-sm text-sm font-medium text-slate-700 hover:bg-slate-50 whitespace-nowrap"
            >
              <div class="w-5 h-5 flex items-center justify-center mr-2">
                <i class="ri-tools-line"></i>
              </div>
              Tools and Add-ons
            </button>
            <!-- THE TIME/DATE ELEMENT BELOW WILL BE MOVED
            <div
              class="flex items-center px-3 py-2 bg-white border border-slate-300 rounded-button shadow-sm text-sm font-medium text-slate-700"
            >
              <div class="w-5 h-5 flex items-center justify-center mr-2">
                <i class="ri-time-line"></i>
              </div>
              1:00 pm · 12 Sep, 2022
            </div>
            -->
          </div>
          <div
            class="absolute flex flex-col gap-4 w-[400px] top-4 right-4 p-0 m-0 z-10"
          >
            <!-- Status Indicators -->
            <div
              class="bg-white rounded-md shadow-md flex flex-col space-y-3 w-[400px] px-6 py-5 pb-0"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <i class="ri-sun-line text-slate-500"></i>
                  <h3 class="text-sm font-medium text-slate-900">Weather</h3>
                </div>
                <div class="flex items-center">
                  <button
                    class="m-0 -ml-1 border-transparent flex items-center text-xs border hover:border-slate-200 p-2 py-1.5 hover:shadow-sm rounded-sm transition-all duration-200"
                  >
                    <i class="ri-arrow-left-s-line"></i>
                  </button>
                  <button
                    id="date-toggle-btn"
                    class="m-0 -ml-1 border-transparent flex items-center text-xs border hover:border-slate-200 p-2 py-1.5 hover:shadow-sm rounded-sm transition-all duration-200"
                  >
                    <i class="ri-calendar-2-line mr-1"></i>
                    <span id="current-date-display">Today</span>
                  </button>
                  <button
                    class="m-0 -ml-1 border-transparent flex items-center text-xs border hover:border-slate-200 p-2 py-1.5 hover:shadow-sm rounded-sm transition-all duration-200"
                  >
                    <i class="ri-arrow-right-s-line"></i>
                  </button>
                </div>
              </div>
              <!-- Date Component (now merged into the main card) -->
              <div class="flex flex-col items-start text-xs text-slate-500">
                <!-- Weather Data -->
                <div class="flex justify-between w-full items-start">
                  <div class="flex justify-between w-full items-center">
                    <div class="flex items-start gap-3">
                      <img
                        src="https://ibb.co/8D62vS9R"
                        class="w-16 h-16 -ml-2"
                      />
                      <div>
                        <div class="flex items-start gap-1 mt-1">
                          <div
                            class="text-xl font-semibold text-slate-900 -mb-1"
                          >
                            23
                          </div>
                          <span class="text-slate-400 text-md">°C</span>
                        </div>
                        <div class="text-xs text-slate-400 mt-1">
                          Partly Cloudy
                        </div>
                      </div>
                    </div>
                    <div class="flex items-start gap-3">
                      <button
                        class="flex items-start gap-3 bg-yellow-100 p-2 rounded-sm hover:bg-yellow-200"
                      >
                        <div class="flex items-center gap-1 font-medium">
                          <i class="ri-star-half-fill text-yellow-500"></i>
                          <span class="text-slate-900">1.9/5</span>
                        </div>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="bg-white rounded-md transition-all duration-200 group cursor-pointer pt-4"
              >
                <div class="flex justify-between items-start mb-3">
                  <div class="flex items-center gap-2">
                    <i class="ri-bard-line text-slate-500"></i>
                    <h3 class="text-sm font-medium text-slate-900">
                      AI Overview
                    </h3>
                  </div>
                  <div class="flex items-center space-x-3">
                    <div class="relative group/violation">
                      <button
                        id="violation-alert-btn"
                        class="flex items-center text-xs text-red-500 border border-red-200 hover:text-red-600 p-2 py-1.5 shadow-sm hover:shadow-md hover:shadow-red-200 rounded-sm transition-all duration-200"
                      >
                        <i class="ri-alert-line mr-1"></i>
                        1 violation
                      </button>
                    </div>
                    <button
                      href="#"
                      class="flex shadow-sm hover:bg-white hover:shadow-md rounded-sm border border-slate-300 p-2 py-1.5 items-center text-xs font-semibold text-slate-600 hover:text-slate-900 font-medium"
                    >
                      Full stats
                      <i class="ri-arrow-right-line ml-1"></i>
                    </button>
                  </div>
                </div>

                <div class="flex justify-between gap-4 mt-2 mb-4">
                  <!-- People Flow Data -->
                  <div class="p-2 px-2 rounded-md hover:bg-slate-50">
                    <div class="mb-1">
                      <div class="flex items-end gap-2">
                        <div class="text-4xl font-medium text-slate-900 -mb-1">
                          78
                        </div>
                        <span class="text-slate-400 text-md">People</span>
                      </div>
                      <div class="flex text-xs items-end gap-1 mt-2">
                        <div class="font-semibold text-red-500">
                          <i class="ri-arrow-down-line"></i>
                          2
                        </div>
                        <span class="text-slate-400">vs avg</span>
                      </div>
                    </div>
                  </div>

                  <!-- Safety Compliance Data -->
                  <div class="p-2 px-2 rounded-md hover:bg-slate-50">
                    <div class="mb-1">
                      <div class="flex items-end gap-2">
                        <div class="text-4xl font-medium text-slate-900 -mb-1">
                          92
                        </div>
                        <span class="text-slate-400 text-md">%</span>
                        <div class="text-slate-400 text-md">Compliant</div>
                      </div>
                      <div
                        class="text-xs text-green-600 mt-1 flex items-center mt-2 font-semibold"
                      >
                        <i class="ri-arrow-up-line mr-0.5"></i>
                        <span class="text-green-600 font-medium mr-1"
                          >2.1% </span
                        ><span class="text-slate-400">vs Yesterday</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class="h-[1px] bg-gradient-to-r from-white via-slate-100 to-white"
                ></div>
                <!-- Safety Sparkline -->
                <div class="pt-4">
                  <button
                    id="expand-stats-btn"
                    class="flex items-center py-2 mb-5 rounded-sm text-slate-500 hover:text-slate-900 text-sm font-medium transition-colors cursor-pointer w-full justify-between"
                  >
                    <span class="flex items-center">
                      <i
                        class="ri-bar-chart-box-ai-line text-slate-500 mr-2"
                      ></i>
                      <span>View Charts</span>
                    </span>
                    <i
                      class="ri-arrow-down-s-line text-lg transition-transform"
                    ></i>
                  </button>
                </div>
                <div id="sparkline-container" class="overflow-visible">
                  <div
                    class="sparkline flex flex-row h-48 justify-between relative overflow-visible"
                  >
                    <!-- Average line -->
                    <div
                      class="absolute top-1/4 -left-8 w-[384px] -translate-y-1/4 flex flex-row items-center z-50"
                    >
                      <div
                        class="bg-black/90 px-2 py-1 text-xs text-white font-medium rounded-sm"
                      >
                        92%
                        <!-- <i class="ri-git-commit-line"></i> -->
                      </div>
                      <div
                        class="w-full h-[1px] bg-black/20 top-1/2 -translate-y-1/2 flex flex-row"
                      ></div>
                    </div>
                    <!-- Date Range -->
                    <!-- <div class="absolute -top-6 left-0 text-xs text-slate-500">
                    10 May
                  </div>
                  <div class="absolute -top-6 right-0 text-xs text-slate-500">
                    17 May
                  </div> -->
                    <div
                      class="bar-container gap-2 w-10 h-full flex flex-col group hover:bg-slate-100 items-center justify-end tooltip-container sparkline-bar-interactive"
                      data-date="May 14"
                      data-time="08:00 AM"
                      data-people="8"
                      data-safety-score="92%"
                      data-vest-count="7"
                      data-helmet-count="8"
                      data-compliant-count="7"
                      data-noncompliant-count="1"
                      data-tags="Compliant,Vest,Helmet"
                    >
                      <div
                        class="w-6 bg-green-500/60 rounded-md hover:bg-green-500/80 transition-colors relative cursor-pointer"
                        data-target-height="8rem"
                      >
                        <div class="tooltip-content">May 14 - 92%</div>
                      </div>
                      <div class="text-xs text-slate-400">Mo</div>
                    </div>
                    <div
                      class="bar-container gap-2 w-10 h-full flex flex-col group hover:bg-slate-100 items-center justify-end tooltip-container sparkline-bar-interactive"
                      data-date="May 15"
                      data-time="09:30 AM"
                      data-people="10"
                      data-safety-score="95%"
                      data-vest-count="9"
                      data-helmet-count="10"
                      data-compliant-count="9"
                      data-noncompliant-count="1"
                      data-tags="Compliant,Vest,Helmet"
                    >
                      <div
                        class="w-6 bg-green-500/60 rounded-md hover:bg-green-500/80 transition-colors relative cursor-pointer"
                        data-target-height="10rem"
                      >
                        <div class="tooltip-content">May 15 - 95%</div>
                      </div>
                      <div class="text-xs text-slate-400">Tu</div>
                    </div>
                    <div
                      class="bar-container gap-2 w-10 h-full flex flex-col group hover:bg-slate-100 items-center justify-end tooltip-container sparkline-bar-interactive"
                      data-date="May 16"
                      data-time="11:00 AM"
                      data-people="12"
                      data-safety-score="88%"
                      data-vest-count="10"
                      data-helmet-count="11"
                      data-compliant-count="10"
                      data-noncompliant-count="2"
                      data-tags="Non-Compliant,Vest,Helmet,Violation"
                    >
                      <div
                        class="w-6 bg-orange-500/60 rounded-md hover:bg-orange-500/80 transition-colors relative cursor-pointer"
                        data-target-height="7rem"
                      >
                        <div class="tooltip-content flex items-center">
                          May 16 - 88%
                          <i class="ri-alert-line text-red-400 ml-1"></i>
                          <span class="text-red-400">(1 violation)</span>
                        </div>
                      </div>
                      <div class="text-xs text-slate-400">We</div>
                    </div>
                    <div
                      class="bar-container gap-2 w-10 h-full flex flex-col group hover:bg-slate-100 items-center justify-end tooltip-container sparkline-bar-interactive"
                      data-date="May 17"
                      data-time="01:15 PM"
                      data-people="9"
                      data-safety-score="91%"
                      data-vest-count="8"
                      data-helmet-count="9"
                      data-compliant-count="8"
                      data-noncompliant-count="1"
                      data-tags="Compliant,Vest,Helmet"
                    >
                      <div
                        class="w-6 bg-green-500/60 rounded-md hover:bg-green-500/80 transition-colors relative cursor-pointer"
                        data-target-height="9rem"
                      >
                        <div class="tooltip-content">May 17 - 91%</div>
                      </div>
                      <div class="text-xs text-slate-400">Th</div>
                    </div>
                    <div
                      class="bar-container gap-2 w-10 h-full flex flex-col group hover:bg-slate-100 items-center justify-end tooltip-container sparkline-bar-interactive"
                      data-date="May 18"
                      data-time="02:45 PM"
                      data-people="11"
                      data-safety-score="94%"
                      data-vest-count="10"
                      data-helmet-count="11"
                      data-compliant-count="10"
                      data-noncompliant-count="1"
                      data-tags="Compliant,Vest,Helmet"
                    >
                      <div
                        class="w-6 bg-green-500/60 rounded-md hover:bg-green-500/80 transition-colors relative cursor-pointer"
                        data-target-height="11rem"
                      >
                        <div class="tooltip-content">May 18 - 94%</div>
                      </div>
                      <div class="text-xs text-slate-400">Fr</div>
                    </div>
                    <div
                      class="bar-container gap-2 w-10 h-full flex flex-col group hover:bg-slate-100 items-center justify-end tooltip-container"
                    >
                      <div
                        class="w-6 bg-green-500/60 rounded-md hover:bg-green-500/80 transition-colors relative cursor-pointer"
                        data-target-height="9rem"
                      >
                        <div class="tooltip-content flex items-center">
                          May 19 - 90%
                          <i class="ri-alert-line text-red-400 ml-1"></i>
                          <span class="text-red-400">(2 violations)</span>
                        </div>
                      </div>
                      <div class="text-xs text-slate-400">Sa</div>
                    </div>
                    <div
                      class="bar-container gap-2 w-10 h-full flex flex-col group hover:bg-slate-100 items-center justify-end tooltip-container"
                    >
                      <div
                        class="w-6 bg-green-500 rounded-md hover:bg-green-500/90 transition-colors relative cursor-pointer"
                        data-target-height="8rem"
                      >
                        <div class="tooltip-content flex items-center">
                          Today - 92%
                          <i class="ri-alert-line text-red-400 ml-1"></i>
                          <span class="text-red-400">(1 violation)</span>
                        </div>
                      </div>
                      <div class="text-xs text-slate-400">Su</div>
                    </div>
                  </div>
                  <div
                    class="flex w-full items-center justify-between text-xs text-slate-400 mt-4 mb-6"
                  >
                    <span class="font-medium">May 15th</span>
                    <span class="font-medium">Today</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- Side Tools -->
            <div class="flex flex-row gap-2 self-end">
              <button
                class="w-10 h-10 bg-white rounded-button shadow-md flex items-center justify-center border border-slate-200 hover:bg-slate-50"
              >
                <div class="w-6 h-6 flex items-center justify-center">
                  <i class="ri-building-line"></i>
                </div>
              </button>
              <button
                class="w-10 h-10 bg-white rounded-button shadow-md flex items-center justify-center border border-slate-200 hover:bg-slate-50"
              >
                <div class="w-6 h-6 flex items-center justify-center">
                  <i class="ri-fullscreen-line"></i>
                </div>
              </button>
              <button
                class="w-10 h-10 bg-white rounded-button shadow-md flex items-center justify-center border border-slate-200 hover:bg-slate-50 relative"
              >
                <div class="w-6 h-6 flex items-center justify-center">
                  <i class="ri-message-3-line"></i>
                </div>
                <div
                  class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"
                ></div>
              </button>
              <button
                class="w-10 h-10 bg-white rounded-button shadow-md flex items-center justify-center border border-slate-200 hover:bg-slate-50"
              >
                <div class="w-6 h-6 flex items-center justify-center">
                  <i class="ri-share-line"></i>
                </div>
              </button>
              <button
                class="w-10 h-10 bg-white rounded-button shadow-md flex items-center justify-center border border-slate-200 hover:bg-slate-50"
              >
                <div class="w-6 h-6 flex items-center justify-center">
                  <i class="ri-printer-line"></i>
                </div>
              </button>
            </div>
          </div>
          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const expandStatsBtn =
                document.getElementById("expand-stats-btn");
              const sparklineContainer = document.getElementById(
                "sparkline-container"
              );
              const dateToggleBtn = document.getElementById("date-toggle-btn");
              const dateSelector = document.getElementById(
                "date-selector-container"
              );
              const currentDateDisplay = document.getElementById(
                "current-date-display"
              );

              let isExpanded = false;
              let isDateSelectorVisible = false;

              // Apply initial state via class for CSS animations
              if (!isExpanded) {
                // Should be collapsed by default
                sparklineContainer.classList.remove("expanded");
                // Heights will be 0 due to CSS, no need to set here
              } else {
                sparklineContainer.classList.add("expanded");
                // If it were to be expanded by default, trigger animation here
                const bars = sparklineContainer.querySelectorAll(
                  ".bar-container .w-6"
                );
                bars.forEach((bar, index) => {
                  const targetHeight = bar.dataset.targetHeight || "100px";
                  setTimeout(() => {
                    bar.style.height = targetHeight;
                  }, index * 50); // Staggered animation
                });
              }

              expandStatsBtn.addEventListener("click", function () {
                isExpanded = !isExpanded;
                if (isExpanded) {
                  sparklineContainer.classList.add("expanded");
                  // Trigger animations for bars
                  const bars = sparklineContainer.querySelectorAll(
                    ".bar-container .w-6"
                  );
                  bars.forEach((bar, index) => {
                    // Get the target height from data attribute or inline style
                    const originalHeightClass = Array.from(bar.classList).find(
                      (cls) => cls.startsWith("h-")
                    );
                    let targetHeight = bar.dataset.targetHeight; // Use data-target-height first

                    if (!targetHeight && originalHeightClass) {
                      // Fallback to calculate from h- class if needed
                      // This is a simplified conversion, assumes h-X is X*0.25rem
                      // And 1rem = 16px. This might not be robust.
                      // Prefer data-target-height.
                      const heightValue = parseInt(
                        originalHeightClass.substring(2)
                      );
                      if (!isNaN(heightValue)) {
                        // Tailwind h- classes: h-32 = 8rem, h-40 = 10rem etc.
                        // The numeric value in h-xx usually corresponds to value*0.25rem.
                        // So, h-32 is 32*0.25rem = 8rem.
                        // We need this in a unit that style.height accepts, like 'px' or 'rem'.
                        // Let's assume the h- values map to rems as per Tailwind's scale.
                        // e.g. h-32 is 8rem.
                        // This logic might need to be more robust if you use varied Tailwind height units.
                        // For now, I will use the data-target-height values.
                      }
                    }

                    // Ensure height is set back to 0 before animating if re-expanding multiple times
                    // but for the first expand, it's already 0 from CSS
                    // bar.style.height = '0px'; // Reset if needed for re-animation

                    setTimeout(() => {
                      bar.style.height = targetHeight;
                    }, index * 75); // Staggered animation (75ms delay)
                  });

                  expandStatsBtn.querySelector("i").style.transform =
                    "rotate(180deg)";
                  expandStatsBtn.querySelector("span").textContent =
                    "Hide Charts";
                } else {
                  sparklineContainer.classList.remove("expanded");
                  // Reset bar heights to 0 for the collapse animation to work if re-expanded
                  const bars = sparklineContainer.querySelectorAll(
                    ".bar-container .w-6"
                  );
                  bars.forEach((bar) => {
                    bar.style.height = "0";
                  });
                  expandStatsBtn.querySelector("i").style.transform =
                    "rotate(0deg)"; // Ensure it's 0deg for collapsed
                  expandStatsBtn.querySelector("span").textContent =
                    "View Charts";
                }
              });

              dateToggleBtn.addEventListener("click", function () {
                isDateSelectorVisible = !isDateSelectorVisible;
                if (isDateSelectorVisible) {
                  dateSelector.style.display = "block";
                  dateToggleBtn.querySelector("span").textContent =
                    "Hide Calendar";
                } else {
                  dateSelector.style.display = "none";
                  dateToggleBtn.querySelector("span").textContent =
                    "Change Date";
                }
              });

              // Update current date in overview
              const today = new Date();
              const dateStr = today.toLocaleDateString("en-US", {
                day: "numeric",
                month: "short",
                year: "numeric",
              });
              currentDateDisplay.textContent = dateStr;

              // Safety Snapshot Modal Logic
              const safetySnapshotModal = document.getElementById(
                "safety-snapshot-modal"
              );
              const closeSafetySnapshotModalBtn = document.getElementById(
                "close-safety-snapshot-modal-btn"
              );
              const safetySnapshotModalOverlay = document.getElementById(
                "safety-snapshot-modal-overlay"
              );
              const sparklineBars = document.querySelectorAll(
                ".sparkline-bar-interactive"
              );

              const snapshotPrevBtn =
                document.getElementById("snapshot-prev-btn");
              const snapshotNextBtn =
                document.getElementById("snapshot-next-btn");
              let currentSnapshotIndex = 0;

              const snapshotDateTime =
                document.getElementById("snapshot-datetime");
              const snapshotPeopleDetected = document.getElementById(
                "snapshot-people-detected"
              );
              const snapshotSafetyScore = document.getElementById(
                "snapshot-safety-score"
              );
              const snapshotVestCount = document.getElementById(
                "snapshot-vest-count"
              );
              const snapshotVestPercentage = document.getElementById(
                "snapshot-vest-percentage"
              );
              const snapshotVestBar =
                document.getElementById("snapshot-vest-bar");
              const snapshotHelmetCount = document.getElementById(
                "snapshot-helmet-count"
              );
              const snapshotHelmetPercentage = document.getElementById(
                "snapshot-helmet-percentage"
              );
              const snapshotHelmetBar = document.getElementById(
                "snapshot-helmet-bar"
              );
              const snapshotCompliantCount = document.getElementById(
                "snapshot-compliant-count"
              );
              const snapshotCompliantPercentage = document.getElementById(
                "snapshot-compliant-percentage"
              );
              const snapshotCompliantBar = document.getElementById(
                "snapshot-compliant-bar"
              );
              const snapshotNoncompliantCount = document.getElementById(
                "snapshot-noncompliant-count"
              );
              const snapshotNoncompliantPercentage = document.getElementById(
                "snapshot-noncompliant-percentage"
              );
              const snapshotNoncompliantBar = document.getElementById(
                "snapshot-noncompliant-bar"
              );
              const snapshotTagsContainer = document.getElementById(
                "snapshot-tags-container"
              );

              if (
                safetySnapshotModal &&
                closeSafetySnapshotModalBtn &&
                safetySnapshotModalOverlay &&
                snapshotPrevBtn &&
                snapshotNextBtn
              ) {
                const populateSnapshotModal = (barElement) => {
                  const data = {
                    date: barElement.dataset.date,
                    time: barElement.dataset.time,
                    people: barElement.dataset.people,
                    safetyScore: barElement.dataset.safetyScore,
                    vestCount: barElement.dataset.vestCount,
                    helmetCount: barElement.dataset.helmetCount,
                    compliantCount: barElement.dataset.compliantCount,
                    noncompliantCount: barElement.dataset.noncompliantCount,
                    tags: barElement.dataset.tags,
                  };

                  snapshotDateTime.textContent = `${data.date} - ${data.time}`;
                  snapshotPeopleDetected.textContent = data.people;
                  snapshotSafetyScore.textContent = data.safetyScore;

                  const totalPeople = parseInt(data.people) || 1; // Avoid division by zero

                  const vestCount = parseInt(data.vestCount) || 0;
                  const helmetCount = parseInt(data.helmetCount) || 0;
                  const compliantCount = parseInt(data.compliantCount) || 0;
                  const nonCompliantCount =
                    parseInt(data.noncompliantCount) || 0;

                  snapshotVestCount.textContent = vestCount;
                  let vestPercentage =
                    totalPeople > 0
                      ? ((vestCount / totalPeople) * 100).toFixed(0)
                      : 0;
                  snapshotVestPercentage.textContent = `${vestPercentage}%`;
                  snapshotVestBar.style.width = `${vestPercentage}%`;

                  snapshotHelmetCount.textContent = helmetCount;
                  let helmetPercentage =
                    totalPeople > 0
                      ? ((helmetCount / totalPeople) * 100).toFixed(0)
                      : 0;
                  snapshotHelmetPercentage.textContent = `${helmetPercentage}%`;
                  snapshotHelmetBar.style.width = `${helmetPercentage}%`;

                  snapshotCompliantCount.textContent = compliantCount;
                  let compliantPercentage =
                    totalPeople > 0
                      ? ((compliantCount / totalPeople) * 100).toFixed(0)
                      : 0;
                  snapshotCompliantPercentage.textContent = `${compliantPercentage}%`;
                  snapshotCompliantBar.style.width = `${compliantPercentage}%`;

                  snapshotNoncompliantCount.textContent = nonCompliantCount;
                  let nonCompliantPercentage =
                    totalPeople > 0
                      ? ((nonCompliantCount / totalPeople) * 100).toFixed(0)
                      : 0;
                  snapshotNoncompliantPercentage.textContent = `${nonCompliantPercentage}%`;
                  snapshotNoncompliantBar.style.width = `${nonCompliantPercentage}%`;

                  snapshotTagsContainer.innerHTML = ""; // Clear previous tags
                  const tags = data.tags ? data.tags.split(",") : [];
                  tags.forEach((tag) => {
                    const tagEl = document.createElement("span");
                    tagEl.className =
                      "px-2 py-1 text-xs font-medium rounded-full";
                    if (
                      tag.toLowerCase().includes("non-compliant") ||
                      tag.toLowerCase().includes("violation")
                    ) {
                      tagEl.classList.add("bg-red-100", "text-red-700");
                    } else if (tag.toLowerCase().includes("compliant")) {
                      tagEl.classList.add("bg-green-100", "text-green-700");
                    } else {
                      tagEl.classList.add("bg-slate-100", "text-slate-700");
                    }
                    tagEl.textContent = tag;
                    snapshotTagsContainer.appendChild(tagEl);
                  });

                  safetySnapshotModal.classList.add("flex");
                };

                const updateNavButtons = () => {
                  snapshotPrevBtn.disabled = currentSnapshotIndex === 0;
                  snapshotNextBtn.disabled =
                    currentSnapshotIndex === sparklineBars.length - 1;
                };

                const openSnapshotModalAtIndex = (index) => {
                  if (index >= 0 && index < sparklineBars.length) {
                    currentSnapshotIndex = index;
                    populateSnapshotModal(sparklineBars[currentSnapshotIndex]);
                    updateNavButtons();
                    if (safetySnapshotModal.classList.contains("hidden")) {
                      safetySnapshotModal.classList.remove("hidden");
                      safetySnapshotModal.classList.add("flex");
                    }
                  }
                };

                snapshotPrevBtn.addEventListener("click", () => {
                  openSnapshotModalAtIndex(currentSnapshotIndex - 1);
                });

                snapshotNextBtn.addEventListener("click", () => {
                  openSnapshotModalAtIndex(currentSnapshotIndex + 1);
                });

                const closeSnapshotModal = function () {
                  safetySnapshotModal.classList.add("hidden");
                  safetySnapshotModal.classList.remove("flex");
                };

                closeSafetySnapshotModalBtn.addEventListener(
                  "click",
                  closeSnapshotModal
                );
                safetySnapshotModalOverlay.addEventListener(
                  "click",
                  closeSnapshotModal
                );

                sparklineBars.forEach((bar, index) => {
                  bar.addEventListener("click", function () {
                    openSnapshotModalAtIndex(index);
                  });
                });
              }

              // Expanded Timeline & Popover Logic
              const expandedTimelineDiv =
                document.getElementById("expanded-timeline");
              const timelineThumbnailsContainer = document.getElementById(
                "timeline-thumbnails-container"
              );
              const timelinePopover =
                document.getElementById("timeline-popover");
              const popoverImage = document.getElementById("popover-image");
              const popoverTime = document.getElementById("popover-time");
              const popoverDetails = document.getElementById("popover-details");
              const popoverStatusDots = document.getElementById(
                "popover-status-dots"
              );
              const expandedTimelineDateEl = document.getElementById(
                "expanded-timeline-date"
              );
              const timelinePrevDayBtn =
                document.getElementById("timeline-prev-day");
              const timelineNextDayBtn =
                document.getElementById("timeline-next-day");

              let currentTimelineDate = new Date(2022, 7, 28); // Aug 28, 2022 (Month is 0-indexed)
              let timelineEventsData = []; // This will hold data for the current day

              // Sample data generation function (replace with actual data fetching)
              function getTimelineEventsForDate(date) {
                const seed = date.getDate(); // Simple seed based on day
                const events = [];
                const startHour = 7;
                const numEvents = 10 + (seed % 5); // Vary number of events
                for (let i = 0; i < numEvents; i++) {
                  const hour = startHour + Math.floor(i / 2);
                  const minute = (i % 2) * 30;
                  const eventTime = new Date(
                    date.getFullYear(),
                    date.getMonth(),
                    date.getDate(),
                    hour,
                    minute
                  );
                  const peopleCount = 5 + ((seed + i) % 10);
                  let status = "Safe";
                  let violations = [];
                  if ((seed + i) % 5 === 0) {
                    status = "Alert";
                    violations.push({
                      type: "Missing Helmet",
                      count: ((seed + i) % 2) + 1,
                    });
                  } else if ((seed + i) % 3 === 0) {
                    status = "Warning";
                    violations.push({ type: "No Vest", count: 1 });
                  }
                  events.push({
                    id: `evt-${date.getTime()}-${i}`,
                    time: eventTime,
                    imageUrl: `https://placehold.co/120x80?text=Event+${i}`,
                    popoverImageUrl: `https://placehold.co/320x160?text=Popover+${i}`,
                    status: status, // 'Safe', 'Warning', 'Alert'
                    peopleDetected: peopleCount,
                    violations: violations, // Array of {type: string, count: int}
                  });
                }
                return events;
              }

              function formatTimeForDisplay(date) {
                return date.toLocaleTimeString("en-US", {
                  hour: "2-digit",
                  minute: "2-digit",
                  hour12: true,
                });
              }

              function renderTimelineThumbnails() {
                if (
                  !timelineThumbnailsContainer ||
                  !expandedTimelineDiv.classList.contains("active")
                )
                  return;
                timelineThumbnailsContainer.innerHTML = ""; // Clear existing
                expandedTimelineDateEl.textContent =
                  currentTimelineDate.toLocaleDateString("en-US", {
                    weekday: "short",
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                  });

                timelineEventsData.forEach((event) => {
                  const thumbDiv = document.createElement("div");
                  thumbDiv.className =
                    "timeline-thumbnail-item group relative flex-shrink-0 w-28 cursor-pointer rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1";
                  thumbDiv.dataset.eventId = event.id;

                  const img = document.createElement("img");
                  img.src = event.imageUrl;
                  img.alt = `Event at ${formatTimeForDisplay(event.time)}`;
                  img.className = "w-full h-20 object-cover";

                  const timeOverlay = document.createElement("div");
                  timeOverlay.className =
                    "absolute bottom-0 left-0 right-0 p-1.5 bg-black/50 text-white text-xs text-center font-medium";
                  timeOverlay.textContent = formatTimeForDisplay(event.time);

                  let borderColor = "border-transparent";
                  if (event.status === "Alert") borderColor = "border-red-500";
                  else if (event.status === "Warning")
                    borderColor = "border-yellow-500";
                  thumbDiv.classList.add("border-2", borderColor);

                  thumbDiv.appendChild(img);
                  thumbDiv.appendChild(timeOverlay);
                  timelineThumbnailsContainer.appendChild(thumbDiv);
                });
                attachPopoverEvents();
              }

              function updateTimelineNavButtons() {
                // Basic: disable next if current date is today or later
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                timelineNextDayBtn.disabled = currentTimelineDate >= today;
                // Prev can always be enabled unless specific logic is added
              }

              function changeTimelineDate(days) {
                currentTimelineDate.setDate(
                  currentTimelineDate.getDate() + days
                );
                timelineEventsData =
                  getTimelineEventsForDate(currentTimelineDate);
                renderTimelineThumbnails();
                updateTimelineNavButtons();
              }

              timelinePrevDayBtn.addEventListener("click", () =>
                changeTimelineDate(-1)
              );
              timelineNextDayBtn.addEventListener("click", () =>
                changeTimelineDate(1)
              );

              function showTimelinePopover(
                eventData,
                targetElement,
                clientX,
                isPulsatingDot = false
              ) {
                popoverImage.src = eventData.popoverImageUrl;
                popoverTime.textContent = formatTimeForDisplay(eventData.time);

                let detailsHTML = `<p>People Detected: <span class="font-semibold">${eventData.peopleDetected}</span></p>`;
                if (eventData.violations && eventData.violations.length > 0) {
                  detailsHTML += eventData.violations
                    .map(
                      (v) =>
                        `<p class="text-red-600">${v.type}: <span class="font-semibold">${v.count}</span></p>`
                    )
                    .join("");
                }
                popoverDetails.innerHTML = detailsHTML;

                popoverStatusDots.innerHTML = "";
                const statusDot = document.createElement("span");
                statusDot.className = "w-2.5 h-2.5 rounded-full";
                const statusText = document.createElement("span");
                statusText.className = "ml-1.5 text-xs font-medium";

                if (eventData.status === "Alert") {
                  statusDot.classList.add("bg-red-500");
                  statusText.textContent = "Alert";
                  statusText.classList.add("text-red-600");
                } else if (eventData.status === "Warning") {
                  statusDot.classList.add("bg-yellow-500");
                  statusText.textContent = "Warning";
                  statusText.classList.add("text-yellow-600");
                } else {
                  statusDot.classList.add("bg-green-500");
                  statusText.textContent = "Safe";
                  statusText.classList.add("text-green-600");
                }
                popoverStatusDots.appendChild(statusDot);
                popoverStatusDots.appendChild(statusText);

                // Show/Hide Escalate/Resolve buttons
                const popoverActions =
                  document.getElementById("popover-actions");
                if (isPulsatingDot) {
                  popoverActions.classList.remove("hidden");
                } else {
                  popoverActions.classList.add("hidden");
                }

                const timelineControlsRect =
                  timelinePopover.parentElement.getBoundingClientRect(); // Parent is the timeline controls div
                let popoverLeft, popoverBottom;
                if (
                  targetElement.classList.contains("timeline-thumbnail-item")
                ) {
                  // Expanded view hover
                  const rect = targetElement.getBoundingClientRect();
                  popoverLeft =
                    rect.left -
                    timelineControlsRect.left +
                    rect.width / 2 -
                    timelinePopover.offsetWidth / 2;
                  popoverBottom =
                    timelineControlsRect.height -
                    (rect.top - timelineControlsRect.top) +
                    10; // 10px offset
                } else if (targetElement.classList.contains("pulsating-dot")) {
                  // Pulsating dot hover
                  const dotRect = targetElement.getBoundingClientRect();
                  popoverLeft =
                    dotRect.left -
                    timelineControlsRect.left +
                    dotRect.width / 2 -
                    timelinePopover.offsetWidth / 2;
                  popoverBottom =
                    timelineControlsRect.height -
                    (dotRect.top - timelineControlsRect.top) +
                    20; // 20px offset from dot
                } else {
                  // Compact view slider hover
                  const sliderRect = targetElement.getBoundingClientRect();
                  popoverLeft =
                    clientX - sliderRect.left - timelinePopover.offsetWidth / 2;
                  popoverBottom = sliderRect.height + 15; // 15px offset from compact timeline
                }

                // Ensure popover stays within the horizontal bounds of the timelineControlsRect
                popoverLeft = Math.max(0, popoverLeft);
                popoverLeft = Math.min(
                  timelineControlsRect.width - timelinePopover.offsetWidth - 5,
                  popoverLeft
                ); // 5px padding from edge

                timelinePopover.style.left = `${popoverLeft}px`;
                timelinePopover.style.bottom = `${popoverBottom}px`;

                timelinePopover.classList.remove(
                  "opacity-0",
                  "scale-95",
                  "pointer-events-none"
                );
                timelinePopover.classList.add("opacity-100", "scale-100");
              }

              function hideTimelinePopover() {
                timelinePopover.classList.add(
                  "opacity-0",
                  "scale-95",
                  "pointer-events-none"
                );
                timelinePopover.classList.remove("opacity-100", "scale-100");
              }

              function attachPopoverEvents() {
                document
                  .querySelectorAll(".timeline-thumbnail-item")
                  .forEach((item) => {
                    item.addEventListener("mouseenter", function () {
                      const eventId = this.dataset.eventId;
                      const eventData = timelineEventsData.find(
                        (e) => e.id === eventId
                      );
                      if (eventData) {
                        showTimelinePopover(
                          eventData,
                          this,
                          eventData.time.getTime()
                        );
                      }
                    });
                    item.addEventListener("mouseleave", function () {
                      hideTimelinePopover();
                    });
                  });
              }

              // Function to render pulsating dots on compact timeline
              function renderPulsatingDots() {
                if (
                  !compactTimelineDiv ||
                  !timelineSlider ||
                  expandedTimelineDiv.classList.contains("active")
                )
                  return;
                compactTimelineDiv
                  .querySelectorAll(".pulsating-dot")
                  .forEach((dot) => dot.remove());

                // Predefined percentages where red appears in the gradient
                const redHintPercentages = [10.5, 41, 56, 80];

                redHintPercentages.forEach((percent, index) => {
                  const dot = document.createElement("div");
                  dot.className = "pulsating-dot cursor-pointer";
                  dot.style.left = `${percent}%`;
                  dot.style.top = "50%";

                  // Try to find a nearby actual alert event for popover data, otherwise use generic
                  let associatedEvent = null;
                  const sliderMax = parseInt(timelineSlider.max) || 48;
                  const targetSliderValue = (percent / 100) * sliderMax;

                  // Find the closest alert event within a small range of the dot's position
                  const alertEvents = timelineEventsData.filter(
                    (event) => event.status === "Alert"
                  );
                  let minDiff = Infinity;

                  alertEvents.forEach((event) => {
                    let eventSliderValue =
                      (event.time.getHours() - 7) * 2 +
                      event.time.getMinutes() / 30;
                    const diff = Math.abs(eventSliderValue - targetSliderValue);
                    if (diff < minDiff && diff < 2) {
                      // Consider events within ~1 hour (2 slider units)
                      minDiff = diff;
                      associatedEvent = event;
                    }
                  });

                  dot.dataset.dotId = `dot-${index}`;
                  if (associatedEvent) {
                    dot.dataset.eventId = associatedEvent.id; // Link to actual event if found
                  }

                  dot.addEventListener("mouseenter", function (e) {
                    let eventDataForPopover = associatedEvent;
                    if (!eventDataForPopover) {
                      // Generic popover for visual cue if no specific event is close
                      const approxTime = new Date(currentTimelineDate);
                      const totalMinutes = 7 * 60 + (percent / 100) * (16 * 60); // Approx time between 7am and 11pm (16 hours)
                      approxTime.setHours(
                        Math.floor(totalMinutes / 60),
                        totalMinutes % 60
                      );

                      eventDataForPopover = {
                        id: `generic-alert-${index}`,
                        time: approxTime,
                        imageUrl: `https://readdy.ai/api/search-image?query=abstract%20warning%20signal&width=320&height=160&seq=grad${index}&orientation=landscape`,
                        popoverImageUrl: `https://readdy.ai/api/search-image?query=abstract%20warning%20signal&width=320&height=160&seq=grad${index}large&orientation=landscape`,
                        status: "Alert",
                        peopleDetected: "N/A",
                        violations: [{ type: "Potential Anomaly", count: 1 }],
                      };
                    }
                    showTimelinePopover(
                      eventDataForPopover,
                      this,
                      e.clientX,
                      true
                    ); // True for isPulsatingDot
                  });
                  dot.addEventListener("mouseleave", function () {
                    hideTimelinePopover();
                  });

                  compactTimelineDiv.appendChild(dot);
                });
              }

              // Modify existing timeline toggle logic
              const timelineToggleBtn =
                document.getElementById("timeline-toggle");
              const compactTimelineDiv =
                document.getElementById("compact-timeline");
              const timelineSlider = document.getElementById("timeline-slider");

              if (
                timelineToggleBtn &&
                compactTimelineDiv &&
                expandedTimelineDiv
              ) {
                timelineToggleBtn.addEventListener("click", function () {
                  const isExpanded =
                    expandedTimelineDiv.classList.contains("active");
                  if (isExpanded) {
                    expandedTimelineDiv.classList.remove("active");
                    expandedTimelineDiv.classList.add("hidden");
                    compactTimelineDiv.classList.remove("hidden");
                    this.innerHTML =
                      '<i class="ri-fullscreen-line"></i><span>Expand Timeline</span>';
                    renderPulsatingDots(); // Render dots when switching to compact view
                  } else {
                    expandedTimelineDiv.classList.add("active");
                    expandedTimelineDiv.classList.remove("hidden");
                    compactTimelineDiv.classList.add("hidden");
                    this.innerHTML =
                      '<i class="ri-fullscreen-exit-line"></i><span>Collapse Timeline</span>';
                    // Initial load for expanded timeline
                    timelineEventsData =
                      getTimelineEventsForDate(currentTimelineDate);
                    renderTimelineThumbnails();
                    updateTimelineNavButtons();
                    compactTimelineDiv
                      .querySelectorAll(".pulsating-dot")
                      .forEach((dot) => dot.remove()); // Clear dots when switching to expanded
                  }
                });
              }

              // Initial call to render dots if compact view is default
              if (!expandedTimelineDiv.classList.contains("active")) {
                timelineEventsData =
                  getTimelineEventsForDate(currentTimelineDate); // Ensure data is loaded
                renderPulsatingDots();
              }

              // Timeline Playback Speed Control
              const speedToggleButton =
                document.getElementById("speed-toggle-btn");
              const playPauseButton = document.getElementById("play-pause-btn"); // Assuming you give play button this ID

              let currentSpeedIndex = 0;
              const speeds = [1, 1.5, 2];
              const baseIntervalTime = 1000; // 1 second for 1x speed
              let currentPlaybackIntervalTime =
                baseIntervalTime / speeds[currentSpeedIndex];

              if (speedToggleButton && playPauseButton) {
                speedToggleButton.addEventListener("click", function () {
                  currentSpeedIndex = (currentSpeedIndex + 1) % speeds.length;
                  const newSpeed = speeds[currentSpeedIndex];
                  currentPlaybackIntervalTime = baseIntervalTime / newSpeed;
                  this.querySelector("span").textContent = `${newSpeed}x`;

                  // If currently playing, clear and restart interval with new speed
                  if (isPlaying && playInterval) {
                    clearInterval(playInterval);
                    playInterval = setInterval(() => {
                      if (timelineSlider.value < timelineSlider.max) {
                        timelineSlider.value++;
                        updateTimeDisplay(timelineSlider.value);
                        // No need to update tooltip display here, it's on input/mousemove
                      } else {
                        isPlaying = false;
                        playPauseButton
                          .querySelector("i")
                          .classList.replace("ri-pause-line", "ri-play-line");
                        clearInterval(playInterval);
                      }
                    }, currentPlaybackIntervalTime);
                  }
                });

                playPauseButton.addEventListener("click", function () {
                  isPlaying = !isPlaying;
                  const icon = this.querySelector("i");
                  if (isPlaying) {
                    icon.classList.replace("ri-play-line", "ri-pause-line");
                    playInterval = setInterval(() => {
                      if (timelineSlider.value < timelineSlider.max) {
                        timelineSlider.value++;
                        updateTimeDisplay(timelineSlider.value);
                      } else {
                        isPlaying = false;
                        icon.classList.replace("ri-pause-line", "ri-play-line");
                        clearInterval(playInterval);
                      }
                    }, currentPlaybackIntervalTime); // Use currentPlaybackIntervalTime
                  } else {
                    icon.classList.replace("ri-pause-line", "ri-play-line");
                    clearInterval(playInterval);
                  }
                });
              }
            });
          </script>
          <!-- Camera Feed -->
          <div
            class="camera-feed w-full h-full flex items-center justify-center relative"
          >
            <!-- Timeline Controls -->
            <div
              class="absolute bottom-0 left-0 right-0 bg-white/30 backdrop-blur-sm p-4"
            >
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-4">
                  <div class="flex items-center gap-2 text-white">
                    <span id="timeline-date" class="text-sm font-medium"
                      >07:00 am · 28 Aug, 2022</span
                    >
                  </div>
                  <button
                    id="play-pause-btn"
                    class="w-8 h-8 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center"
                  >
                    <div
                      class="w-5 h-5 flex items-center justify-center text-white"
                    >
                      <i class="ri-play-line"></i>
                    </div>
                  </button>
                  <button
                    id="speed-toggle-btn"
                    class="w-16 h-8 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white text-xs font-medium px-2"
                  >
                    <i class="ri-speed-up-line mr-1"></i>
                    <span>1x</span>
                  </button>
                </div>
                <button
                  id="timeline-toggle"
                  class="flex items-center gap-2 px-3 py-1.5 bg-white/50 hover:bg-white/30 rounded-full text-black/80 text-sm"
                >
                  <i class="ri-fullscreen-line"></i>
                  <span>Expand Timeline</span>
                </button>
              </div>
              <div id="compact-timeline" class="relative">
                <div
                  class="timeline-track w-full h-1.5 rounded-full relative overflow-hidden"
                  style="
                    background: linear-gradient(
                      to right,
                      rgba(0, 255, 0, 0.2) 0%,
                      rgba(0, 255, 0, 0.5) 10%,
                      rgba(255, 0, 0, 0.6) 10.5%,
                      rgba(255, 0, 0, 0.3) 11.5%,
                      rgba(0, 255, 0, 0.4) 12.5%,
                      rgba(0, 255, 0, 0.6) 25%,
                      rgba(255, 255, 0, 0.4) 35%,
                      rgba(255, 255, 0, 0.6) 40%,
                      rgba(255, 0, 0, 0.5) 41%,
                      rgba(255, 0, 0, 0.2) 42%,
                      rgba(255, 255, 0, 0.5) 43%,
                      rgba(0, 255, 0, 0.5) 55%,
                      rgba(255, 0, 0, 0.7) 56%,
                      rgba(255, 0, 0, 0.4) 57.5%,
                      rgba(0, 255, 0, 0.3) 58.5%,
                      rgba(0, 255, 0, 0.7) 70%,
                      rgba(255, 165, 0, 0.5) 78%,
                      rgba(255, 0, 0, 0.4) 80%,
                      rgba(255, 0, 0, 0.2) 81%,
                      rgba(255, 165, 0, 0.4) 82%,
                      rgba(0, 255, 0, 0.4) 90%,
                      rgba(0, 255, 0, 0.2) 100%
                    );
                  "
                ></div>
                <div
                  class="timeline-checkpoints absolute top-0 w-full flex justify-between pointer-events-none"
                >
                  <div
                    class="checkpoint-dots absolute w-full flex justify-between px-1 -m-[1px]"
                  ></div>
                </div>
                <input
                  type="range"
                  min="0"
                  max="48"
                  value="0"
                  class="timeline-slider w-full h-1 absolute top-0 left-0 opacity-0 cursor-pointer"
                  id="timeline-slider"
                />
                <div
                  class="preview-container absolute bottom-full left-0 mb-4 hidden"
                  id="timeline-preview"
                >
                  <div
                    class="preview-image w-48 h-32 bg-cover bg-center rounded-lg shadow-lg"
                  ></div>
                  <div
                    class="absolute -top-8 left-0 transform -translate-x-1/2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded text-xs font-medium"
                    id="timeline-tooltip"
                  ></div>
                </div>
              </div>
              <div
                id="expanded-timeline"
                class="hidden bg-white/90 backdrop-blur-sm rounded-lg p-4 mt-3"
              >
                <div class="flex gap-2 items-center mb-3 px-2">
                  <button
                    id="timeline-prev-day"
                    class="p-1.5 rounded-md hover:bg-slate-200 text-slate-600 disabled:opacity-50"
                  >
                    <i class="ri-arrow-left-s-line text-lg"></i>
                  </button>
                  <div
                    id="expanded-timeline-date"
                    class="text-sm font-semibold text-slate-700"
                  >
                    <!-- Date will be populated by JS -->
                  </div>
                  <button
                    id="timeline-next-day"
                    class="p-1.5 rounded-md hover:bg-slate-200 text-slate-600 disabled:opacity-50"
                  >
                    <i class="ri-arrow-right-s-line text-lg"></i>
                  </button>
                </div>
                <div
                  id="timeline-thumbnails-container"
                  class="custom-scrollbar flex overflow-x-auto space-x-3 pb-3 px-2"
                >
                  <!-- Thumbnails will be populated here by JS -->
                </div>
              </div>

              <!-- Timeline Hover Popover (initially hidden) -->
              <div
                id="timeline-popover"
                class="absolute bottom-full mb-3 p-3 bg-white rounded-lg shadow-2xl w-80 z-[100] opacity-0 pointer-events-none transition-all duration-200 ease-out scale-95"
              >
                <img
                  id="popover-image"
                  src=""
                  alt="Timeline Event"
                  class="w-full h-40 object-cover rounded-md mb-2"
                />
                <div
                  id="popover-time"
                  class="text-sm font-semibold text-slate-800 mb-1"
                ></div>
                <div
                  id="popover-details"
                  class="text-xs text-slate-600 space-y-0.5"
                >
                  <!-- Details like violations, people count etc. -->
                </div>
                <div id="popover-status-dots" class="flex space-x-1.5 mt-2">
                  <!-- Status dots like Safe, Warning, Alert -->
                </div>
                <div
                  id="popover-actions"
                  class="mt-3 pt-3 border-t border-slate-200 flex justify-end space-x-2 hidden"
                >
                  <button
                    class="px-3 py-1.5 text-xs font-medium text-white bg-primary hover:bg-primary/90 rounded-md transition-colors"
                  >
                    Resolve
                  </button>
                  <button
                    class="px-3 py-1.5 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors"
                  >
                    Escalate
                  </button>
                </div>
              </div>
              <!-- End Timeline Hover Popover -->

              <style>
                .timeline-track {
                  position: relative;
                  overflow: hidden;
                }
                .bar-container {
                  width: 100%;
                  overflow: visible;
                  flex-direction: column;
                  padding: 0 8px;
                  background: linear-gradient(#ffffff, #ffffff) 50% 50% /
                      calc(100% - 2px) calc(100% - 2px) no-repeat,
                    linear-gradient(
                      154deg,
                      rgba(255, 255, 255, 0.98) 0%,
                      rgba(179, 179, 179, 0.1) 50%,
                      rgba(255, 255, 255, 0.92) 100%
                    );
                  border-radius: 0px;
                  padding: 1px;
                  box-sizing: border-box;
                  align-items: center;
                  justify-content: flex-end;
                  margin-left: -1px;
                }
                .bar-container:hover {
                  background: linear-gradient(
                    154deg,
                    rgba(255, 255, 255, 0.98) 0%,
                    rgba(179, 179, 179, 0.1) 50%,
                    rgba(255, 255, 255, 0.92) 100%
                  );
                }
                .checkpoint-dot {
                  width: 6px;
                  height: 6px;
                  border-radius: 9999px;
                  background-color: rgba(0, 0, 0, 0.1);
                  position: absolute;
                  transform: translateX(-50%);
                }
                .checkpoint-dot.active {
                  background-color: #ff5722;
                }
                .preview-container {
                  transform: translateX(-50%);
                  z-index: 50;
                }
                .timeline-card {
                  transition: transform 0.2s;
                }
                .timeline-card:hover {
                  transform: translateY(-4px);
                }
              </style>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Violation Modal -->
    <div
      id="violation-modal"
      class="fixed inset-0 z-[1000] items-center justify-center hidden bg-black/50 backdrop-blur-sm"
    >
      <div id="violation-modal-overlay" class="absolute inset-0"></div>
      <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-auto z-10">
        <div class="p-6">
          <div class="flex items-start justify-between mb-4">
            <div>
              <h4 class="text-lg font-semibold text-slate-900">
                Safety Violation Alert
              </h4>
              <p class="text-sm text-slate-500 mt-0.5">Detected at 06:45 AM</p>
            </div>
            <button
              id="close-violation-modal-btn"
              class="text-slate-400 hover:text-slate-600 transition-colors"
            >
              <i class="ri-close-line text-2xl"></i>
            </button>
          </div>

          <div
            class="w-full h-48 rounded-lg mb-4 bg-cover bg-center"
            style="
              background-image: url('https://readdy.ai/api/search-image?query=construction%20worker%20without%20safety%20helmet%20on%20construction%20site%2C%20clear%20violation%20visible%2C%20safety%20concern%2C%20realistic%20photo&width=400&height=192&seq=violationModal&orientation=landscape');
            "
          ></div>

          <div class="space-y-3 text-sm">
            <div class="flex justify-between items-center">
              <span class="text-slate-600">Type:</span>
              <span class="font-medium text-red-600"
                >Missing Safety Helmet</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-600">Location:</span>
              <span class="text-slate-800 font-medium">Zone B, Level 2</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-600">Worker ID:</span>
              <span class="text-slate-800 font-medium">EMP-00123</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-600">Status:</span>
              <span
                class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded-full"
              >
                <div class="w-2 h-2 bg-yellow-500 rounded-full mr-1.5"></div>
                Pending Review
              </span>
            </div>
          </div>

          <div
            class="mt-6 pt-4 border-t border-slate-200 flex justify-end space-x-3"
          >
            <button
              class="px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-md transition-colors"
            >
              Acknowledge
            </button>
            <button
              class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-md transition-colors"
            >
              Resolve
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Violation Modal -->

    <!-- Safety Snapshot Modal -->
    <div
      id="safety-snapshot-modal"
      class="fixed inset-0 z-[1000] items-center justify-center hidden bg-black/50 backdrop-blur-sm"
    >
      <div id="safety-snapshot-modal-overlay" class="absolute inset-0"></div>
      <div class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-auto z-10">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-slate-900">
              Safety Snapshot
            </h3>
            <button
              id="close-safety-snapshot-modal-btn"
              class="text-slate-400 hover:text-slate-600 transition-colors"
            >
              <i class="ri-close-line text-2xl"></i>
            </button>
          </div>
          <div class="flex items-center space-x-3 mb-5">
            <button
              id="snapshot-prev-btn"
              class="p-1 text-slate-500 hover:text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <i class="ri-arrow-left-s-line text-2xl"></i>
            </button>
            <div
              id="snapshot-datetime"
              class="text-sm text-slate-600 font-medium"
            ></div>
            <button
              id="snapshot-next-btn"
              class="p-1 text-slate-500 hover:text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <i class="ri-arrow-right-s-line text-2xl"></i>
            </button>
          </div>

          <div class="grid grid-cols-2 gap-x-6 gap-y-4 mb-6">
            <div>
              <div class="text-xs text-slate-500 mb-0.5">People Detected</div>
              <div
                id="snapshot-people-detected"
                class="text-2xl font-semibold text-slate-800"
              ></div>
            </div>
            <div>
              <div class="text-xs text-slate-500 mb-0.5">Safety Score</div>
              <div
                id="snapshot-safety-score"
                class="text-2xl font-semibold text-slate-800"
              ></div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-x-6 gap-y-4 mb-6">
            <div class="text-sm">
              <div class="flex justify-between items-center mb-1">
                <span class="text-slate-600">Vest Compliance</span>
                <div>
                  <span
                    id="snapshot-vest-count"
                    class="font-medium text-slate-800"
                  ></span>
                  (<span
                    id="snapshot-vest-percentage"
                    class="font-medium text-slate-800"
                  ></span
                  >)
                </div>
              </div>
              <div class="h-2.5 bg-slate-200 rounded-full overflow-hidden">
                <div
                  id="snapshot-vest-bar"
                  class="h-full bg-blue-500 rounded-full transition-all duration-300"
                ></div>
              </div>
            </div>
            <div class="text-sm">
              <div class="flex justify-between items-center mb-1">
                <span class="text-slate-600">Helmet Compliance</span>
                <div>
                  <span
                    id="snapshot-helmet-count"
                    class="font-medium text-slate-800"
                  ></span>
                  (<span
                    id="snapshot-helmet-percentage"
                    class="font-medium text-slate-800"
                  ></span
                  >)
                </div>
              </div>
              <div class="h-2.5 bg-slate-200 rounded-full overflow-hidden">
                <div
                  id="snapshot-helmet-bar"
                  class="h-full bg-green-500 rounded-full transition-all duration-300"
                ></div>
              </div>
            </div>
            <div class="text-sm">
              <div class="flex justify-between items-center mb-1">
                <span class="text-slate-600">Overall Compliance</span>
                <div>
                  <span
                    id="snapshot-compliant-count"
                    class="font-medium text-slate-800"
                  ></span>
                  (<span
                    id="snapshot-compliant-percentage"
                    class="font-medium text-slate-800"
                  ></span
                  >)
                </div>
              </div>
              <div class="h-2.5 bg-slate-200 rounded-full overflow-hidden">
                <div
                  id="snapshot-compliant-bar"
                  class="h-full bg-teal-500 rounded-full transition-all duration-300"
                ></div>
              </div>
            </div>
            <div class="text-sm">
              <div class="flex justify-between items-center mb-1">
                <span class="text-slate-600">Non-Compliant / Violations</span>
                <div>
                  <span
                    id="snapshot-noncompliant-count"
                    class="font-medium text-red-600"
                  ></span>
                  (<span
                    id="snapshot-noncompliant-percentage"
                    class="font-medium text-red-600"
                  ></span
                  >)
                </div>
              </div>
              <div class="h-2.5 bg-slate-200 rounded-full overflow-hidden">
                <div
                  id="snapshot-noncompliant-bar"
                  class="h-full bg-red-500 rounded-full transition-all duration-300"
                ></div>
              </div>
            </div>
          </div>

          <div
            id="snapshot-tags-container"
            class="flex flex-wrap gap-2 pt-4 border-t border-slate-200"
          >
            <!-- Tags will be populated by JS -->
          </div>

          <!-- Legend for Progress Bars -->
          <div class="mt-5 pt-4 border-t border-slate-200">
            <h4 class="text-sm font-semibold text-slate-700 mb-2">Legend:</h4>
            <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs">
              <div class="flex items-center">
                <span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span>
                <span>Vest Compliance</span>
              </div>
              <div class="flex items-center">
                <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                <span>Helmet Compliance</span>
              </div>
              <div class="flex items-center">
                <span class="w-3 h-3 rounded-full bg-teal-500 mr-2"></span>
                <span>Overall Compliance</span>
              </div>
              <div class="flex items-center">
                <span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span>
                <span>Non-Compliant / Violations</span>
              </div>
            </div>
          </div>
          <!-- End Legend -->
        </div>
      </div>
    </div>
    <!-- End Safety Snapshot Modal -->
  </body>
</html>
